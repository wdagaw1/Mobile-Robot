# main.py 功能分析报告

## 1. 概述
`main.py` 是整个移动机器人（无人机）仿真项目的入口脚本。它的主要功能是在一个包含圆柱体障碍物的三维飞行环境中，演示从**路径规划**（Path Planning）到**轨迹生成**（Trajectory Generation），再到**三维可视化**（3D Visualization）的完整流程。

脚本对比了两种经典的路径规划算法（A* 和 RRT），并生成符合动力学约束的连续飞行轨迹。

## 2. 详细流程分析

### 2.1 环境初始化
- **创建环境**：实例化 `FlightEnvironment` 类，设置环境大小（50x50x10等）。该类内部封装了障碍物（圆柱体）的生成和管理。
- **设定任务**：定义了无人机的起始位置 `start = (1, 2, 0)` 和目标位置 `goal = (18, 18, 3)`。

### 2.2 路径规划 (Path Planning)
脚本使用了 `PathPlanner` 类来执行离散路径搜索：

1.  **A* 算法规划**：
    -   调用 `planner.plan(start, goal)` 生成原始的离散网格路径。
    -   调用 `planner.simplify_path(raw_path)` 对原始路径进行平滑处理，去除不必要的拐点，得到 `smooth_path`。这是后续轨迹生成的首选路径。

2.  **RRT 算法规划 (对比实验)**：
    -   调用 `planner.plan_rrt(start, goal)` 生成第二条路径。
    -   RRT（快速扩展随机树）是一种基于采样的算法，用于与基于搜索的 A* 算法进行效果对比。

### 2.3 轨迹生成 (Trajectory Generation)
脚本使用 `TrajectoryGenerator` 类将离散的路径点转换为随时间变化的连续轨迹：

-   **A* 轨迹生成**：
    -   基于 `smooth_path`，调用 `traj_gen.generate_trajectory(...)`。
    -   输出包括：时间序列 `t`，位置 `traj` (x,y,z)，速度 `vel`，加速度 `acc` 以及安全性标志 `safe`。
-   **RRT 轨迹生成**：
    -   如果 RRT 路径规划成功，同样为其生成连续轨迹，用于在可视化中进行对比。

### 2.4 三维可视化 (3D Visualization)
脚本包含了一个高度定制化的可视化模块，使用 `matplotlib` 的 `Axes3D` 和 `Poly3DCollection`：

1.  **障碍物绘制**：
    -   使用 `Poly3DCollection` 批量绘制环境中的圆柱体障碍物。
    -   通过计算圆柱体的侧面和顶面顶点，构建多边形集合，相比简单的 `plot_surface` 性能更好且视觉效果更清晰（半透明、边缘线）。

2.  **路径与轨迹绘制**：
    -   **离散路径**：
        -   A* 平滑路径显示为**蓝色粗实线**。
        -   RRT 路径显示为**红色虚线**。
    -   **连续轨迹**：
        -   A* 轨迹显示为**青色细线**。
        -   RRT 轨迹显示为**浅红色细线**。

3.  **场景设置**：
    -   设置坐标轴范围、标签、标题，并保持三维比例一致 (`set_axes_equal`)。

### 2.5 动力学分析可视化
-   如果 A* 轨迹生成成功，脚本最后会调用 `traj_gen.visualize_dynamics(...)`。
-   该函数通常会生成一个新的图表，展示无人机在 x, y, z 三个轴向上的位置、速度或加速度随时间的变化曲线，验证轨迹的可行性。

## 3. 核心依赖模块
-   `flight_environment.py`: 定义飞行区域和障碍物。
-   `path_planner.py`: 实现 A* 和 RRT 路径搜索算法。
-   `trajectory_generator.py`: 实现最小平滑轨迹生成（通常基于多项式插值或优化）及动力学检查。

## 4. 总结
该脚本是一个标准的机器人运动规划演示程序，它清晰地展示了“**感知(环境) -> 规划(离散路径) -> 控制(连续轨迹)**”这一分层架构，并提供了直观的视觉反馈来验证算法的有效性。
